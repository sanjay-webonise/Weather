<!DOCTYPE html>
<html>
  <head>
    <title>Weather Widget 2</title>     
    <style type="text/css">
        body { background-color:#ffffff; }
            
        .tileTextDisplay {
            font-family: arial,sans-serif;
            font-weight: lighter !important;
            color: #878787 !important;
        }
        .largerFont {
            font-size: x-large !important;
        }
        .mediumFont {
            font-size: medium !important;
        }
        #weather-temp {
            font-family: 'Arial', sans-serif;
            font-size: 64px;
            color: #212121 !important;
        }
        #unitType {
            font-family: 'Arial', sans-serif;
            font-size: 20px;
            color: #000000 !important;
        }
    </style>
    
    <script>
    var weekday=new Array(7);
    weekday[0]="Sunday";
    weekday[1]="Monday";
    weekday[2]="Tuesday";
    weekday[3]="Wednesday";
    weekday[4]="Thursday";
    weekday[5]="Friday";
    weekday[6]="Saturday";

    /** -- B --
     * Makes an upcall to Java code 
     * WeatherWidget2 clas method queryWeatherByLocationAndUnit()
     */
    function findWeatherByLocation() {
        var cityInfo = encodeURIComponent(document.getElementById('search-field').value);
        setInnerText("error-msg", "");
        WeatherWidget2.queryWeatherByLocationAndUnit(cityInfo, "c");
    }

    /** -- E -- 
     * Called from Java after data is fetched.
     */
    function populateWeatherData(weather, unitType) {
        var jsonWeather = eval("(" + weather + ")");
        if (jsonWeather.message) {
            if (jsonWeather.message.indexOf('Error') === 0 ) {
                document.getElementById('error-msg').innerHTML = jsonWeather.message;
                alert(jsonWeather.message);
                return;
            }
        }

        setInnerText('city', jsonWeather.name);
        setInnerText('country', jsonWeather.sys.country);
        var weatherTime = new Date(jsonWeather.dt);
        var timeStr = timeFormat(jsonWeather.dt);
        setInnerText('weather-day-time', weekday[weatherTime.getDay()] + " " + timeStr); 
        setInnerText('weather-current', jsonWeather.weather[0].main);
        setInnerText('weather-current-desc', jsonWeather.weather[0].description);
        document.getElementById('weather-icon').src = "http://openweathermap.org/img/w/" + jsonWeather.weather[0].icon + ".png";
        setInnerText('weather-temp', jsonWeather.main.temp);
        setInnerText('weather-humidity', "Humidity: " + jsonWeather.main.humidity + "%");
        var windSpeed = (unitType === 'f') ? 'mph' : 'km/h';
        setInnerText('weather-wind-speed', "Wind: " + jsonWeather.wind.speed + " " +windSpeed);

    }

    function setInnerText(id, text) {
       document.getElementById(id).innerText = text; 
    }

    function timeFormat( millis ) {
        var weatherTime = new Date(millis);
        var hours = weatherTime.getHours();
        var minutes = weatherTime.getMinutes();
        var meridian = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12; // hour '0' means '12'
        minutes = minutes < 10 ? '0' + minutes : minutes;
        var timeStr = hours + ':' + minutes + ' ' + meridian;
        return timeStr;
    }
    </script>
    </head>
    <body id="weather_background">
        <form>
            <input id="search-field" placeholder="Enter city, state/country" type="text" name="searchField"/>
            <!-- A -->
            <input id="search-button" type="button" onclick="findWeatherByLocation()" name="searchButton" value="Search"/>
        </form>
        <div id="error-msg"></div>
        <div id="city" class="tileTextDisplay largerFont"></div>
        <div id="country" class="tileTextDisplay mediumFont"></div>
        <div id="weather-day-time" class="tileTextDisplay mediumFont"></div>
        <div id="weather-current" class="tileTextDisplay mediumFont"></div>
        <div id="weather-current-desc" class="tileTextDisplay mediumFont"></div>
        <div>
            <img id="weather-icon" style="float:left;height:64px;width:64px" src="" alt=""/>
            <div id="weather-temp" style="padding-left:10px; float:left;"></div>
            <div style="float:left; font-size:20px; margin-top:6px">
                <span style="display:inline">Â°<span id="unitType">C</span></span>
            </div>
        </div>
        <div style="clear:both;"></div>
        <div id="weather-humidity" class="tileTextDisplay mediumFont"></div>
        <div id="weather-wind-speed" class="tileTextDisplay mediumFont"></div>
</html>
